#
# Copyright 2004 Sun Microsystems, Inc. All rights reserved.
# SUN PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
#

#
# @(#)Makefile	1.6 03/12/19
#

#
# Makefile for building and packaging all of the JDK and the JRE. See
# also included files.
#

#
# Most frequently used targets:
#
#    all            -- stage the images, generate the patch, bind the 
#		       optimized and debug exe. 
#    patchgen       -- generate the patch
#    patcher	    -- build the patch installer
#    stage	    -- stages the jres that we want to patch, however, this 
#		       target activate only if ALT_BASE_IMAGE_ZIP is 
#		       defined, typically for developer and special patches.
#    clobber        -- clobber the files generated by this Makefile 

INSTALL_BUILDDIR=..
include $(INSTALL_BUILDDIR)/common/Defs.gmk

all:: 
	@$(ECHO) $(ARCH) "Patch Build started:  " $(FULL_VERSION)

# sigh. this is a real hack - JRE/JDK packaging and the Plugin
# require absolute paths - In order to get these, OUTPUTDIR must
# exist now. This forces the creation. This is done here so that
# it only happens once.
dummy := $(shell $(MKDIR) -p $(OUTPUTDIR))

ifeq ($(PLATFORM), windows)
SUBDIRS  = stage patchgen patcher 

ifndef  ALT_BASE_IMAGE_JRE_ZIP
ifndef  ALT_BASE_IMAGE_SDK_ZIP
SUBDIRS = patchgen patcher
endif
endif

endif #PLATFORM



all optimized debug::
	@for i in $(SUBDIRS) ; do \
	    $(ECHO) ">>>Recursively making "$$i" "$@" @ `$(DATE)` ..."; \
	    $(CD) $$i; $(MAKE) \
            || exit 1; $(CD) ..; \
	    $(ECHO) "<<<Finished Recursively making "$$i" "$@" @ `$(DATE)`." ; \
	done



patchgen::
	$(CD) patchgen ; $(MAKE) all

patcher::
	$(CD) patcher ; $(MAKE) all

stage::
	$(CD) stage ; $(MAKE) all

#
# Sanity checks.
#
include $(INSTALL_BUILDDIR)/common/Sanity.gmk

clean: clobber

clobber: patch-clobber

patch-clobber::
	@for i in $(SUBDIRS) ; do \
	    $(ECHO) ">>>Recursively making "$$i" "clean" @ `$(DATE)` ..."; \
	    $(CD) $$i; $(MAKE) clean RELEASE="$(RELEASE)" FULL_VERSION="$(FULL_VERSION)" \
            || exit 1; $(CD) ..; \
	    $(ECHO) "<<<Finished Recursively making "$$i" all @ `$(DATE)`." ; \
	done


# this should be the last rule in this file:
all::
	@$(ECHO) $(ARCH) "Patch Build finished:  " $(FULL_VERSION)
#
# Phonies to avoid accidents.
#
.PHONY: all optimized debug clean clobber patch-clobber patchgen patcher stage


